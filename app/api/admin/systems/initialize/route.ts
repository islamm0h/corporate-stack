import { NextRequest, NextResponse } from 'next/server'

export async function POST(request: NextRequest) {
  try {
    const { PrismaClient } = await import('@prisma/client')
    const prisma = new PrismaClient()

    // التحقق من وجود أنظمة مسبقاً
    const existingSystems = await prisma.system.count()
    
    if (existingSystems > 0) {
      return NextResponse.json({
        success: false,
        message: 'الأنظمة موجودة مسبقاً في قاعدة البيانات',
        count: existingSystems
      })
    }

    // البيانات الأساسية للأنظمة
    const basicSystems = [
      {
        name: 'نظام المحاسبة والفاتورة الإلكترونية',
        slug: 'accounting-electronic-invoice-system',
        description: 'نظام متكامل لإدارة الحسابات والفواتير الإلكترونية مع ربط هيئة الزكاة والضريبة والدعم الكامل للمعايير السعودية',
        shortDescription: 'نظام محاسبة متكامل مع فواتير إلكترونية معتمدة',
        category: 'مالي',
        features: [
          'فواتير إلكترونية معتمدة من هيئة الزكاة والضريبة',
          'ربط مباشر مع منصة فاتورة الحكومية',
          'تقارير مالية شاملة ومفصلة',
          'إدارة العملاء والموردين بالكامل',
          'نظام الخزينة والبنوك المتطور',
          'التكامل مع البنوك السعودية',
          'إدارة الأصول الثابتة',
          'نظام المراكز والمشاريع',
          'تقارير الزكاة والضريبة التلقائية',
          'دعم العملات المتعددة'
        ],
        specifications: {
          'نوع الترخيص': 'سحابي ومحلي',
          'عدد المستخدمين': 'غير محدود',
          'قواعد البيانات': 'SQL Server, MySQL, PostgreSQL',
          'أنظمة التشغيل': 'Windows, Linux, macOS',
          'المتصفحات المدعومة': 'جميع المتصفحات الحديثة',
          'التكامل': 'API متكامل',
          'النسخ الاحتياطي': 'تلقائي يومي',
          'الأمان': 'تشفير 256-bit SSL'
        },
        price: 15000,
        currency: 'SAR',
        isActive: true,
        isFeatured: true,
        sortOrder: 1,
        seoTitle: 'نظام المحاسبة والفاتورة الإلكترونية - كوربريت ستاك',
        seoDescription: 'نظام محاسبة متكامل مع فواتير إلكترونية معتمدة من هيئة الزكاة والضريبة السعودية',
        seoKeywords: ['محاسبة', 'فاتورة إلكترونية', 'هيئة الزكاة', 'نظام مالي'],
        version: '3.2.0',
        icon: 'fas fa-calculator',
        color: '#2ecc71',
        status: 'active',
        users: 245,
        uptime: '99.9%'
      },
      {
        name: 'نظام إدارة العملاء (CRM)',
        slug: 'crm-customer-management-system',
        description: 'نظام شامل لإدارة العلاقات مع العملاء وتتبع المبيعات والفرص التجارية مع أدوات تسويق متقدمة',
        shortDescription: 'نظام CRM متطور لإدارة العملاء والمبيعات',
        category: 'مبيعات',
        features: [
          'إدارة شاملة لجهات الاتصال والعملاء',
          'تتبع الفرص التجارية والصفقات',
          'تقارير المبيعات المتقدمة والتحليلات',
          'أتمتة التسويق والحملات الإعلانية',
          'إدارة خط المبيعات (Sales Pipeline)',
          'تحليلات العملاء والسلوك الشرائي',
          'نظام المهام والمتابعة',
          'التكامل مع البريد الإلكتروني',
          'تقارير الأداء والإنتاجية',
          'نظام التنبيهات والإشعارات'
        ],
        specifications: {
          'عدد العملاء': 'غير محدود',
          'التقارير': '50+ تقرير جاهز',
          'التكامل': 'البريد الإلكتروني، الهاتف، WhatsApp',
          'التطبيق المحمول': 'iOS و Android',
          'النسخ الاحتياطي': 'تلقائي كل 6 ساعات',
          'مستوى الأمان': 'عالي جداً',
          'الدعم الفني': '24/7',
          'التحديثات': 'مجانية مدى الحياة'
        },
        price: 12000,
        currency: 'SAR',
        isActive: true,
        isFeatured: true,
        sortOrder: 2,
        seoTitle: 'نظام إدارة العملاء CRM - كوربريت ستاك',
        seoDescription: 'نظام CRM متطور لإدارة العملاء والمبيعات مع أدوات تسويق متقدمة',
        seoKeywords: ['CRM', 'إدارة العملاء', 'مبيعات', 'تسويق'],
        version: '2.8.0',
        icon: 'fas fa-users',
        color: '#3498db',
        status: 'active',
        users: 189,
        uptime: '99.8%'
      },
      {
        name: 'نظام إدارة الموارد البشرية',
        slug: 'hr-human-resources-system',
        description: 'نظام متكامل لإدارة شؤون الموظفين والرواتب والحضور والانصراف مع نظام تقييم الأداء',
        shortDescription: 'نظام HR شامل لإدارة الموظفين والرواتب',
        category: 'موارد بشرية',
        features: [
          'إدارة شاملة لبيانات الموظفين',
          'نظام الرواتب والمكافآت المتطور',
          'الحضور والانصراف الإلكتروني',
          'تقييم الأداء والكفاءات',
          'إدارة الإجازات والطلبات',
          'التقارير الحكومية المطلوبة',
          'نظام التوظيف والمقابلات',
          'إدارة التدريب والتطوير',
          'نظام المخالفات والجزاءات',
          'تقارير الموارد البشرية التفصيلية'
        ],
        specifications: {
          'عدد الموظفين': 'غير محدود',
          'أنواع الرواتب': 'شهري، أسبوعي، يومي',
          'طرق الحضور': 'بصمة، كارت، تطبيق محمول',
          'التقارير الحكومية': 'GOSI، مكتب العمل، الزكاة',
          'العملات': 'ريال سعودي وعملات أخرى',
          'التكامل': 'البنوك، أجهزة البصمة',
          'الأمان': 'تشفير البيانات الشخصية',
          'النسخ الاحتياطي': 'يومي تلقائي'
        },
        price: 18000,
        currency: 'SAR',
        isActive: true,
        isFeatured: true,
        sortOrder: 3,
        seoTitle: 'نظام إدارة الموارد البشرية HR - كوربريت ستاك',
        seoDescription: 'نظام HR متكامل لإدارة الموظفين والرواتب والحضور مع التقارير الحكومية',
        seoKeywords: ['موارد بشرية', 'HR', 'رواتب', 'حضور وانصراف'],
        version: '4.1.0',
        icon: 'fas fa-user-tie',
        color: '#e74c3c',
        status: 'active',
        users: 156,
        uptime: '99.7%'
      },
      {
        name: 'نظام إدارة المخزون',
        slug: 'inventory-management-system',
        description: 'نظام متطور لإدارة المخزون والمواد مع تتبع المستويات والتنبيهات التلقائية وإدارة المستودعات',
        shortDescription: 'نظام مخزون متطور مع تتبع فوري',
        category: 'مخزون',
        features: [
          'تتبع المخزون الفوري والدقيق',
          'إدارة المستودعات المتعددة',
          'تقارير الجرد التفصيلية والشاملة',
          'تنبيهات النفاد التلقائية',
          'إدارة الموردين والمشتريات',
          'نظام الباركود المتطور',
          'إدارة تواريخ الانتهاء',
          'تكلفة المخزون المتوسطة',
          'تقارير الحركة والدوران',
          'التكامل مع نقاط البيع'
        ],
        specifications: {
          'عدد الأصناف': 'غير محدود',
          'المستودعات': 'متعددة بلا حدود',
          'طرق التكلفة': 'FIFO، LIFO، المتوسط المرجح',
          'الباركود': 'دعم جميع الأنواع',
          'التقارير': '40+ تقرير مخزون',
          'التنبيهات': 'SMS، إيميل، داخل النظام',
          'التكامل': 'POS، محاسبة، مبيعات',
          'الجرد': 'دوري وفوري'
        },
        price: 10000,
        currency: 'SAR',
        isActive: true,
        isFeatured: true,
        sortOrder: 4,
        seoTitle: 'نظام إدارة المخزون - كوربريت ستاك',
        seoDescription: 'نظام مخزون متطور مع تتبع فوري وتنبيهات تلقائية وإدارة مستودعات متعددة',
        seoKeywords: ['مخزون', 'مستودعات', 'جرد', 'باركود'],
        version: '2.5.0',
        icon: 'fas fa-boxes',
        color: '#f39c12',
        status: 'active',
        users: 98,
        uptime: '99.6%'
      },
      {
        name: 'نظام نقاط البيع (POS)',
        slug: 'pos-point-of-sale-system',
        description: 'نظام نقاط بيع متطور مع إدارة المبيعات والمخزون والعملاء وتقارير شاملة للمتاجر والمطاعم',
        shortDescription: 'نظام POS متكامل للمتاجر والمطاعم',
        category: 'مبيعات',
        features: [
          'واجهة بيع سهلة وسريعة',
          'إدارة المنتجات والأسعار',
          'نظام الخصومات والعروض',
          'تقارير المبيعات اليومية',
          'إدارة العملاء والنقاط',
          'ربط مع أجهزة الطباعة والدرج',
          'نظام الفواتير الإلكترونية',
          'تتبع المخزون الفوري',
          'تقارير الأرباح والخسائر',
          'دعم طرق الدفع المتعددة'
        ],
        specifications: {
          'أنواع الأعمال': 'متاجر، مطاعم، صيدليات، محلات',
          'طرق الدفع': 'نقدي، فيزا، ماستركارد، مدى، STC Pay',
          'الأجهزة المدعومة': 'طابعات، درج نقدي، قارئ باركود',
          'التقارير': '25+ تقرير مبيعات',
          'المنتجات': 'غير محدود',
          'الفروع': 'متعددة',
          'التطبيق المحمول': 'Android و iOS',
          'النسخ الاحتياطي': 'سحابي تلقائي'
        },
        price: 8000,
        currency: 'SAR',
        isActive: true,
        isFeatured: true,
        sortOrder: 5,
        seoTitle: 'نظام نقاط البيع POS - كوربريت ستاك',
        seoDescription: 'نظام POS متطور للمتاجر والمطاعم مع إدارة المبيعات والمخزون والفواتير الإلكترونية',
        seoKeywords: ['نقاط البيع', 'POS', 'متاجر', 'مطاعم', 'كاشير'],
        version: '1.8.0',
        icon: 'fas fa-cash-register',
        color: '#9b59b6',
        status: 'active',
        users: 78,
        uptime: '99.4%'
      }
    ]

    // إضافة الأنظمة الأساسية
    for (const systemData of basicSystems) {
      await prisma.system.create({
        data: systemData
      })
    }

    await prisma.$disconnect()

    return NextResponse.json({
      success: true,
      message: `تم إضافة ${basicSystems.length} أنظمة أساسية بنجاح`,
      count: basicSystems.length,
      systems: basicSystems.map(s => ({ name: s.name, slug: s.slug }))
    })

  } catch (error) {
    console.error('Error initializing basic systems:', error)
    return NextResponse.json(
      { success: false, error: 'فشل في إضافة الأنظمة الأساسية' },
      { status: 500 }
    )
  }
}
